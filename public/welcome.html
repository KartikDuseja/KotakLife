<!DOCTYPE html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   
<style>
  @import url('https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap');
*{
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}
body{
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #4070f4;
}
.wrapper{
  position: relative;
  max-width: 430px;
  width: 100%;
  background: #fff;
  padding: 34px;
  border-radius: 6px;
  box-shadow: 0 5px 10px rgba(0,0,0,0.2);
}
.wrapper h2{
  position: relative;
  font-size: 22px;
  font-weight: 600;
  color: #333;
}
.wrapper h2::before{
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  height: 3px;
  width: 28px;
  border-radius: 12px;
  background: #4070f4;
}
.wrapper form{
  margin-top: 30px;
}
.wrapper form .input-box{
  height: 52px;
  margin: 18px 0;
}
form .input-box input{
  height: 100%;
  width: 100%;
  outline: none;
  padding: 0 15px;
  font-size: 17px;
  font-weight: 400;
  color: #333;
  border: 1.5px solid #C7BEBE;
  border-bottom-width: 2.5px;
  border-radius: 6px;
  transition: all 0.3s ease;
}
.input-box input:focus,
.input-box input:valid{
  border-color: #4070f4;
}
form .policy{
  display: flex;
  align-items: center;
}
form h3{
  color: #707070;
  font-size: 14px;
  font-weight: 500;
  margin-left: 10px;
}
.input-box.button input{
  color: #fff;
  letter-spacing: 1px;
  border: none;
  background: #4070f4;
  cursor: pointer;
}
.input-box.button input:hover{
  background: #0e4bf1;
}
form .text h3{
 color: #333;
 width: 100%;
 text-align: center;
}
form .text h3 a{
  color: #4070f4;
  text-decoration: none;
}
form .text h3 a:hover{
  text-decoration: underline;
}

</style>
</head>
<body>
  
    <div class="wrapper">
      
      <h1>Registeration Form</h1>
     
        




<form id= "regform"> 
 <div class="wrapper">
  <h2>Please Upload your ID Proofs</h2>
  <label>Aadhar Card: </label><input type="file" id="aadhar" name = "sampleFile" onchange="aadharPost(event)" accept="image/*" required ><br>
  <label>PAN Card: </label><input type="file" name = "sampleFile1" id="pan" onchange="loadFile(event)" accept="image/*" required><br>
    
    
      <div class="input-box">
        <input type="text" name="naam" id="naam" placeholder="Enter your name" required>
      </div>
      <div class="input-box">
        <input type="text" name="email" id="email" placeholder="Enter your email" required >
      </div>
      <div class="input-box">
        <input type="Gender" name="Gender" id="Gender" placeholder="Enter your Gender" required>
      </div>
      <div class="input-box">
        <input type="number" name="numbers" id="numbers" placeholder="Enter your age" required>
      </div>
      <div class="input-box">
        <input type="text" name="contact" id="contact" placeholder="Enter your contact no" pattern="[6-9]{1}[0-9]{9}" required >
      </div>
      <div class="policy">
        <input type="checkbox" required>
        <h3>I accept all terms & condition</h3>
      </div>
      <div class="input-box button">
        <input type="submit" id="submitButton" value="Register Now">
      </div>
      

</div>
</form>


 </div>

 <script>
  


function create_UUID(){
    var dt = new Date().getTime();
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (dt + Math.random()*16)%16 | 0;
        dt = Math.floor(dt/16);
        return (c=='x' ? r :(r&0x3|0x8)).toString(16);
    });
    return uuid;
}

var uuid = create_UUID();



var aadharPost= function(event)

{
  // Ajax post request for aadhar image save 
var formdata = new FormData()
var sampleFile = $('#aadhar')[0].files[0];
formdata.append('uid',uuid)
formdata.append('sampleFile', sampleFile)
  $.ajax({
       url : '/aadhar',
       type : 'POST',
       data : formdata,
       processData:false,
       contentType: false,  // tell jQuery not to set contentType
       encType: "multipart/form-data",
       success : function(data) {
           console.log('Aadhar file sent to server for upload ');
           
       },
       error:function(data){
        console.log('Error in aadhar file sending ')
       }
});

}

var loadFile = function(event) {
									
										
										// Ajax request for analyzing ids 
										
										
										var fd = new FormData();
										var file = $('#aadhar')[0].files[0];
										var file2 = $('#pan')[0].files[0];
                    
										fd.append('id1',file);
										fd.append('id2',file2);
										
										$.ajax({
                      type:"POST" , 
                      url:'http://insurance.zini.ai/analyze_ids/' ,
                      data: fd,
                      processData:false,
                      contentType: false,
                      success: function(data)
                      {
                        console.log(data)
                        var name = document.getElementById("naam")
                        name.value=data.name
                        var age = document.getElementById("numbers")
                        age.value=data.age
                        var gender = document.getElementById("Gender")
                        gender.value=data.gender
                        
                            
                      },
                      error:function(data)
                      {
                        console.log("Error from analyze ids "+ data)
                      }

                      
                       })


                       // Ajax request for Pan post to server 
                       var formpan= new FormData()
                       var panfile=  $('#pan')[0].files[0];
                       formpan.append('uid',uuid)
                       formpan.append('sampleFile1', panfile)
                       $.ajax({
                         url : '/pan',
                         type : 'POST',
                         data : formpan,
                         processData:false,
                         contentType: false,  // tell jQuery not to set contentType
                         encType: "multipart/form-data",
                         success : function(data) {
                         console.log('Pan file sent to server for upload ');
                         
                          },
                         error:function(data){
                          console.log('Error in pan file sending ')
                            }
                        });
									
                      };

  //Ajax post for form 
  $("#submitButton").click(function(ev) {
            ev.preventDefault()
           // var form = $("#regform");
            var naam = $("#naam").val()
            var email = $("#email").val()
            var gender= $("#Gender").val()
            var age = $("#numbers").val()
            var contact = $("#contact").val()

            var fd = new FormData();
             
										var file = $('#aadhar')[0].files[0];
										var file2 = $('#pan')[0].files[0];
                    
                    fd.append('name',naam);
                    fd.append('email',email);
                    fd.append('gender',gender);
                    fd.append('age',age);
                    fd.append('contact', contact);
                    fd.append('uuid',uuid);
										fd.append('id1',file);
										fd.append('id2',file2);
                    
            
            $.ajax({
                       type:"POST" ,
                       url:'http://insurance.zini.ai/indexface/' ,
                       data: fd,
                       processData:false,
                       contentType: false,  // tell jQuery not to set contentType
                       encType: "multipart/form-data",
                       success:function(data)
                       {
                        console.log("Success")
                       },
                       error:function(data)
                       {
                        console.log("Some error from indexface call")
                       }

                  
                })

            // Ajax Request for Form Submit 
            $.ajax({
                type: "POST",
                url: '/register' ,
                data: {name:naam, email:email, gen:gender, ages:age, phoneno:contact, uid:uuid},
                success: function(data) {
                    
                 
                    // Ajax call completed successfully
                    alert("Form submitted successfully ")
                   
                    
                  location.href="chat.html"+"?uuid=" + uuid + "&name=" + naam +"&email=" + email;
                   
                   console.log(data)
                } ,
                   
               

                error: function(data) {
                      
                    // Some error in ajax call
                    console.log("Error from submit form post");
                }
            });
        });
















 </script>
</body>
</html>
